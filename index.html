<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="description" content="ProteinValue - Compare protein products by cost per gram with barcode scanning">
    <meta name="theme-color" content="#059669">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü•©</text></svg>">
    
    <title>ProteinValue - Smart Protein Shopping</title>
    
    <!-- Barcode Scanner Library (FREE) -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>ü•© ProteinValue</h1>
                <p class="tagline">Scan, Compare, Save Money</p>
            </div>
            <div class="header-actions">
                <button id="my-list-btn" class="header-btn" title="My Favorites">
                    ‚ù§Ô∏è <span class="badge hidden" id="favorites-count">0</span>
                </button>
            </div>
        </header>

        <!-- Main Layout -->
        <main class="main-layout">
            <!-- LEFT SIDEBAR -->
            <aside class="sidebar" id="sidebar">
                <!-- Input Method Toggle -->
                <div class="method-toggle">
                    <button class="method-btn active" data-method="manual">
                        ‚úèÔ∏è Manual Entry
                    </button>
                    <button class="method-btn" data-method="barcode">
                        üì∑ Scan Barcode
                    </button>
                </div>

                <!-- BARCODE SCANNER -->
                <div id="barcode-section" class="barcode-section hidden">
                    <div class="card">
                        <h2 class="card-title">üì∑ Scan Barcode</h2>
                        <p class="card-description">Point camera at product barcode</p>
                        
                        <div id="barcode-reader" class="barcode-reader"></div>
                        
                        <div id="scan-status" class="scan-status hidden">
                            <div class="spinner-small"></div>
                            <span>Looking up product...</span>
                        </div>
                        
                        <div id="scan-result" class="scan-result hidden">
                            <div class="scan-success">‚úÖ Product Found!</div>
                            <div class="scan-product-name" id="scanned-product-name">--</div>
                            <button id="use-scanned-btn" class="btn-primary">Use This Product</button>
                            <button id="scan-again-btn" class="btn-secondary">Scan Another</button>
                        </div>
                        
                        <div id="scan-error" class="scan-error hidden">
                            <div class="error-icon">‚ùå</div>
                            <div class="error-text">Product not found in database</div>
                            <button id="manual-entry-btn" class="btn-secondary">Enter Manually</button>
                        </div>
                        
                        <small class="hint">üí° Uses Open Food Facts database (free & open source)</small>
                    </div>
                </div>

                <!-- MANUAL ENTRY FORM -->
                <div id="manual-section" class="manual-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title" id="form-title">‚ûï Add Product</h2>
                            <button id="cancel-edit-btn" class="cancel-btn hidden">‚úï Cancel</button>
                        </div>
                        
                        <!-- Basic Info -->
                        <div class="form-section">
                            <div class="input-group">
                                <label>Product Name *</label>
                                <input type="text" id="product-name" placeholder="e.g., Optimum Nutrition Gold Standard" autocomplete="off">
                            </div>
                            
                            <div class="input-row">
                                <div class="input-group">
                                    <label>Brand</label>
                                    <input type="text" id="product-brand" placeholder="e.g., Optimum Nutrition" autocomplete="off">
                                </div>
                                <div class="input-group">
                                    <label>Barcode (UPC)</label>
                                    <input type="text" id="product-barcode" placeholder="Optional" autocomplete="off">
                                </div>
                            </div>

                            <div class="input-group">
                                <label>Protein Source *</label>
                                <select id="protein-source">
                                    <option value="">-- Select Source --</option>
                                    <optgroup label="ü•õ Animal-Based">
                                        <option value="whey">Whey Protein</option>
                                        <option value="whey-isolate">Whey Isolate</option>
                                        <option value="casein">Casein</option>
                                        <option value="egg">Egg White</option>
                                        <option value="beef">Beef</option>
                                        <option value="chicken">Chicken</option>
                                        <option value="fish">Fish</option>
                                        <option value="dairy">Dairy (Milk/Yogurt/Cheese)</option>
                                    </optgroup>
                                    <optgroup label="üå± Plant-Based">
                                        <option value="pea">Pea Protein</option>
                                        <option value="soy">Soy Protein</option>
                                        <option value="rice">Rice Protein</option>
                                        <option value="hemp">Hemp Protein</option>
                                        <option value="peanut">Peanut/Nut Butter</option>
                                        <option value="lentil">Lentil/Legume</option>
                                        <option value="blend-plant">Plant Blend</option>
                                    </optgroup>
                                    <optgroup label="üîÄ Other">
                                        <option value="blend-mixed">Mixed Blend</option>
                                        <option value="collagen">Collagen</option>
                                        <option value="other">Other</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>

                        <!-- Pricing -->
                        <div class="form-section">
                            <h3 class="section-title">üí∞ Pricing</h3>
                            <div class="input-row">
                                <div class="input-group">
                                    <label>Price ($) *</label>
                                    <input type="number" id="product-price" placeholder="29.99" step="0.01" min="0">
                                </div>
                                <div class="input-group">
                                    <label>Store</label>
                                    <select id="product-store">
                                        <option value="">-- Optional --</option>
                                        <option value="amazon">Amazon</option>
                                        <option value="costco">Costco</option>
                                        <option value="walmart">Walmart</option>
                                        <option value="target">Target</option>
                                        <option value="gnc">GNC</option>
                                        <option value="vitaminshop">Vitamin Shoppe</option>
                                        <option value="wholefoods">Whole Foods</option>
                                        <option value="traderjoes">Trader Joe's</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="input-row">
                                <div class="input-group">
                                    <label>Container Size</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="container-size" placeholder="2" step="0.1" min="0">
                                        <select id="container-unit">
                                            <option value="lb">lb</option>
                                            <option value="kg">kg</option>
                                            <option value="oz">oz</option>
                                            <option value="g">g</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Protein Content -->
                        <div class="form-section">
                            <h3 class="section-title">üí™ Protein Content</h3>
                            
                            <div class="input-row">
                                <div class="input-group">
                                    <label>Servings per Container *</label>
                                    <input type="number" id="servings-count" placeholder="30" step="1" min="1">
                                </div>
                                <div class="input-group">
                                    <label>Protein per Serving (g) *</label>
                                    <input type="number" id="protein-per-serving" placeholder="24" step="0.1" min="0">
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label>Serving Size</label>
                                <div class="input-with-unit">
                                    <input type="number" id="serving-size" placeholder="33" step="0.1" min="0">
                                    <select id="serving-unit">
                                        <option value="g">g</option>
                                        <option value="scoop">scoop</option>
                                        <option value="oz">oz</option>
                                        <option value="piece">piece</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Live Calculation -->
                            <div class="calculated-box" id="calculated-box">
                                <div class="calc-row">
                                    <span>Total Protein:</span>
                                    <strong id="calc-total-protein">-- g</strong>
                                </div>
                                <div class="calc-row highlight">
                                    <span>Cost per Gram:</span>
                                    <strong id="calc-cost-per-gram">$--</strong>
                                </div>
                                <div class="calc-row">
                                    <span>Protein per Dollar:</span>
                                    <strong id="calc-protein-per-dollar">-- g</strong>
                                </div>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="form-section">
                            <div class="input-group">
                                <label>Notes (Optional)</label>
                                <textarea id="product-notes" placeholder="e.g., Great taste, bought on sale..." rows="2"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="form-actions">
                        <button id="add-product-btn" class="btn-primary btn-large">
                            ‚ûï Add Product
                        </button>
                        <button id="update-product-btn" class="btn-primary btn-large hidden">
                            üíæ Save Changes
                        </button>
                    </div>

                    <!-- Error Message -->
                    <div id="error-message" class="error-message hidden"></div>
                </div>

                <!-- RESULTS SECTION -->
                <div id="results-section" class="results-section hidden">
                    <!-- Best Value Card -->
                    <div id="best-value-card" class="best-value-card">
                        <div class="best-header">üèÜ Best Value</div>
                        <div class="best-product" id="best-product-name">--</div>
                        <div class="best-brand" id="best-product-brand"></div>
                        <div class="best-stats">
                            <div class="best-stat">
                                <span class="stat-label">Cost/gram</span>
                                <span class="stat-value" id="best-cost-per-gram">--</span>
                            </div>
                            <div class="best-stat">
                                <span class="stat-label">Protein/$1</span>
                                <span class="stat-value" id="best-protein-per-dollar">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <span class="qs-value" id="total-products">0</span>
                            <span class="qs-label">Products</span>
                        </div>
                        <div class="quick-stat">
                            <span class="qs-value" id="diversity-count">0</span>
                            <span class="qs-label">Sources</span>
                        </div>
                        <div class="quick-stat">
                            <span class="qs-value" id="savings-percent">--%</span>
                            <span class="qs-label">Savings</span>
                        </div>
                    </div>

                    <!-- Diversity Card -->
                    <div class="diversity-card">
                        <div class="diversity-header">üåà Protein Diversity</div>
                        <div class="diversity-sources" id="diversity-sources"></div>
                        <div class="diversity-tip" id="diversity-tip">Add products from different sources</div>
                    </div>

                    <!-- Products List -->
                    <div class="products-list-card">
                        <div class="list-header">
                            <h3>üìä All Products</h3>
                            <div class="list-actions">
                                <select id="sort-by" class="sort-select">
                                    <option value="cost-asc">Best Value</option>
                                    <option value="cost-desc">Highest Cost</option>
                                    <option value="name-asc">Name A-Z</option>
                                    <option value="date-desc">Recent First</option>
                                </select>
                                <button id="clear-all-btn" class="icon-btn" title="Clear All">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="products-list" id="products-list"></div>
                    </div>
                </div>
            </aside>

            <!-- RIGHT: VISUALIZATION -->
            <section class="viz-section" id="viz-section">
                <div class="viz-container">
                    <div class="chart-placeholder" id="chart-placeholder">
                        <div class="placeholder-icon">üìä</div>
                        <p>Add products to see comparison</p>
                        <small>Scan barcodes or enter manually</small>
                    </div>
                    <canvas id="comparison-chart" class="hidden"></canvas>
                </div>
                
                <!-- Info Cards -->
                <div class="info-cards">
                    <div class="info-card">
                        <h3>üí° Pro Tips</h3>
                        <ul class="tips-list">
                            <li><strong>Scan barcodes</strong> for instant product lookup</li>
                            <li><strong>Compare stores</strong> ‚Äî same product, different prices</li>
                            <li><strong>Check serving size</strong> ‚Äî some brands use smaller scoops</li>
                            <li><strong>Whole foods</strong> often beat powders on $/gram!</li>
                        </ul>
                    </div>
                    
                    <div class="info-card community-card">
                        <h3>üåç Community Prices</h3>
                        <p>Found a better price? Help others save!</p>
                        <button id="report-price-btn" class="btn-secondary btn-small">
                            üì¢ Report a Price
                        </button>
                        <small>Coming soon: See prices others have found</small>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODALS -->
    
    <!-- Product Detail Modal -->
    <div id="product-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Product Details</h3>
                <button class="modal-close" id="close-modal">‚úï</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <!-- Favorites Modal -->
    <div id="favorites-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>‚ù§Ô∏è My Favorite Products</h3>
                <button class="modal-close" id="close-favorites">‚úï</button>
            </div>
            <div class="modal-body" id="favorites-body">
                <div class="empty-state" id="no-favorites">
                    <div class="empty-icon">‚ù§Ô∏è</div>
                    <p>No favorites yet</p>
                    <small>Tap the heart icon on any product to save it</small>
                </div>
                <div class="favorites-list" id="favorites-list"></div>
            </div>
        </div>
    </div>

    <!-- Report Price Modal -->
    <div id="price-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì¢ Report a Price</h3>
                <button class="modal-close" id="close-price-modal">‚úï</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">Help other shoppers by sharing prices you've found!</p>
                
                <div class="input-group">
                    <label>Product</label>
                    <select id="report-product">
                        <option value="">-- Select a product --</option>
                    </select>
                </div>
                
                <div class="input-row">
                    <div class="input-group">
                        <label>Price ($)</label>
                        <input type="number" id="report-price" placeholder="24.99" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>Store</label>
                        <select id="report-store">
                            <option value="">-- Select --</option>
                            <option value="amazon">Amazon</option>
                            <option value="costco">Costco</option>
                            <option value="walmart">Walmart</option>
                            <option value="target">Target</option>
                            <option value="gnc">GNC</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Photo Evidence (Optional)</label>
                    <input type="file" id="report-photo" accept="image/*" capture="environment">
                    <small class="hint">Take a photo of the price tag</small>
                </div>
                
                <button id="submit-price-btn" class="btn-primary">Submit Price Report</button>
                <small class="hint center">üîí Your report will be reviewed before sharing</small>
            </div>
        </div>
    </div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="app.js"></script>
    
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .catch(err => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>
